# Caddy configuration for Dicty Resolwe Server
# This provides automatic HTTPS with Let's Encrypt
# Alternative to nginx if you prefer automatic SSL

95.179.242.134 {
    # Security headers
    header {
        X-Frame-Options "SAMEORIGIN"
        X-XSS-Protection "1; mode=block"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "no-referrer-when-downgrade"
        Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'"
    }

    # API and admin routes - proxy to Django backend
    reverse_proxy /api/* 127.0.0.1:8000
    reverse_proxy /admin/* 127.0.0.1:8000
    reverse_proxy /ws/* 127.0.0.1:8000

    # Serve Django static files
    handle_path /static/* {
        root * /home/dictyapp/dicty_resolwe_server/backend/staticfiles
        file_server
    }

    # Serve frontend static files
    handle {
        root * /home/dictyapp/dicty_resolwe_server/frontend/build
        try_files {path} {path}/ /index.html
        file_server
    }

    # Logging
    log {
        output file /var/log/caddy/access.log {
            roll_size 100MB
            roll_keep 5
        }
        format json
    }
}

# Redirect HTTP to HTTPS (if using a domain)
# http://your-domain.com {
#     redir https://your-domain.com{uri}
# }
